# ğŸš€ Cloudflare Workerså…¨æ ˆè¿ç§»æŒ‡å—

## ğŸ“‹ è¿ç§»æ¦‚è¿°

å°†AIMAGICAä»Next.js + Pagesæ¶æ„è¿ç§»åˆ°çº¯Cloudflare Workerså…¨æ ˆåº”ç”¨ã€‚

### âœ… å·²å®Œæˆ

1. **æ¶æ„è®¾è®¡** - Hono.js + Reactå…¨æ ˆæ¶æ„
2. **é¡¹ç›®ç»“æ„** - Workersé…ç½®å’Œè·¯ç”±ç³»ç»Ÿ
3. **åŸºç¡€é…ç½®** - wrangler.tomlå’Œæ„å»ºè„šæœ¬

### ğŸ”„ è¿ç§»æ­¥éª¤

#### ç¬¬ä¸€é˜¶æ®µï¼šå®‰è£…ä¾èµ–

```bash
# å®‰è£…Workersæ ¸å¿ƒä¾èµ–
npm install hono @cloudflare/kv-asset-handler

# å®‰è£…å¼€å‘ä¾èµ–
npm install -D vite @vitejs/plugin-react
```

#### ç¬¬äºŒé˜¶æ®µï¼šå‰ç«¯èµ„æºè¿ç§»

1. **åˆ›å»ºå‰ç«¯ç›®å½•ç»“æ„**ï¼š
   ```
   frontend/
   â”œâ”€â”€ src/
   â”‚   â”œâ”€â”€ components/     # å¤åˆ¶ç°æœ‰components
   â”‚   â”œâ”€â”€ pages/         # å¤åˆ¶ç°æœ‰appç›®å½•é¡µé¢
   â”‚   â”œâ”€â”€ hooks/         # å¤åˆ¶ç°æœ‰hooks  
   â”‚   â”œâ”€â”€ lib/           # å¤åˆ¶ç°æœ‰lib
   â”‚   â””â”€â”€ styles/        # å¤åˆ¶ç°æœ‰æ ·å¼
   â”œâ”€â”€ public/            # å¤åˆ¶ç°æœ‰public
   â””â”€â”€ index.html         # æ–°çš„å…¥å£HTML
   ```

2. **ä¿®æ”¹å¯¼å…¥è·¯å¾„**ï¼š
   - æ›´æ–°æ‰€æœ‰ç›¸å¯¹å¯¼å…¥è·¯å¾„
   - é…ç½®Viteåˆ«åæ˜ å°„

3. **ç¯å¢ƒå˜é‡å¤„ç†**ï¼š
   - ä»Workersç¯å¢ƒæ³¨å…¥åˆ°å‰ç«¯
   - æ›´æ–°ç¯å¢ƒå˜é‡å¼•ç”¨

#### ç¬¬ä¸‰é˜¶æ®µï¼šAPIè·¯ç”±è¿ç§»

1. **è¿ç§»ç°æœ‰API**ï¼š
   ```bash
   # å½“å‰APIè·¯ç”±
   app/api/generate/image/route.ts     â†’ src/routes/api/generate.ts
   app/api/gallery/upload/route.ts     â†’ src/routes/api/gallery.ts
   app/api/admin/styles/route.ts       â†’ src/routes/api/admin.ts
   # ... å…¶ä»–APIè·¯ç”±
   ```

2. **Supabaseé›†æˆ**ï¼š
   - ä¿æŒç°æœ‰Supabaseé…ç½®
   - æ›´æ–°å®¢æˆ·ç«¯åˆå§‹åŒ–æ–¹å¼

3. **KVå­˜å‚¨é›†æˆ**ï¼š
   - ç¼“å­˜é¢‘ç¹æŸ¥è¯¢æ•°æ®
   - ä¼šè¯å­˜å‚¨ä¼˜åŒ–

#### ç¬¬å››é˜¶æ®µï¼šèµ„æºä¼˜åŒ–

1. **é™æ€èµ„æºå¤„ç†**ï¼š
   - å›¾ç‰‡èµ„æºå†…åµŒåˆ°Workers
   - å­—ä½“æ–‡ä»¶ä¼˜åŒ–åŠ è½½
   - CSS/JSæ‰“åŒ…ä¼˜åŒ–

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä»£ç åˆ†å‰²ç­–ç•¥
   - æ‡’åŠ è½½å®ç°
   - è¾¹ç¼˜ç¼“å­˜ç­–ç•¥

## ğŸ› ï¸ å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼
npm run dev:workers        # å¯åŠ¨Workerså¼€å‘æœåŠ¡å™¨
npm run build:frontend     # æ„å»ºå‰ç«¯èµ„æº
npm run build:workers      # å®Œæ•´æ„å»ºå¹¶éƒ¨ç½²

# éƒ¨ç½²
npm run deploy:workers     # éƒ¨ç½²åˆ°Cloudflare Workers
```

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

```
ai-sketch-platform/
â”œâ”€â”€ src/                   # Workersåç«¯
â”‚   â”œâ”€â”€ index.ts          # ä¸»å…¥å£
â”‚   â”œâ”€â”€ routes/           # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ api/         # APIç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ static/      # é™æ€æ–‡ä»¶å¤„ç†
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ frontend/             # Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/             # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ public/          # é™æ€èµ„æº
â”‚   â””â”€â”€ index.html       # HTMLæ¨¡æ¿
â”œâ”€â”€ dist/                 # æ„å»ºè¾“å‡º
â”œâ”€â”€ wrangler.workers.toml # Workersé…ç½®
â”œâ”€â”€ vite.users.config.ts # å‰ç«¯æ„å»ºé…ç½®
â””â”€â”€ package.json         # æ›´æ–°çš„è„šæœ¬
```

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

| åŠŸèƒ½ | Pagesæ–¹æ¡ˆ | Workersæ–¹æ¡ˆ |
|------|-----------|-------------|
| éƒ¨ç½²å¤æ‚åº¦ | é«˜(Pages+Workers) | ä½(ä»…Workers) |
| å†·å¯åŠ¨æ—¶é—´ | ~100ms | ~1ms |
| å…¨çƒåˆ†å‘ | æ˜¯ | æ˜¯ |
| æˆæœ¬ | ä¸­ç­‰ | æ›´ä½ |
| å¼€å‘ä½“éªŒ | å¤æ‚ | ç®€åŒ– |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |

## ğŸ”§ é…ç½®è¦ç‚¹

### 1. wrangler.tomlé…ç½®
- KVå‘½åç©ºé—´ç»‘å®š
- R2å­˜å‚¨æ¡¶ç»‘å®š  
- ç¯å¢ƒå˜é‡é…ç½®
- å…¼å®¹æ€§æ ‡å¿—

### 2. Viteé…ç½®
- Reactæ’ä»¶é…ç½®
- èµ„æºæ‰“åŒ…ç­–ç•¥
- è·¯å¾„åˆ«åè®¾ç½®
- ä»£ç†APIé…ç½®

### 3. Honoè·¯ç”±
- APIè·¯ç”±ç»„ç»‡
- ä¸­é—´ä»¶é…ç½®
- é”™è¯¯å¤„ç†
- CORSè®¾ç½®

## ğŸš¦ è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] å®‰è£…æ–°ä¾èµ–
- [ ] åˆ›å»ºå‰ç«¯ç›®å½•ç»“æ„
- [ ] å¤åˆ¶å¹¶æ›´æ–°ç»„ä»¶
- [ ] è¿ç§»APIè·¯ç”±
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] æµ‹è¯•æœ¬åœ°å¼€å‘
- [ ] éƒ¨ç½²åˆ°Workers
- [ ] éªŒè¯åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] DNSé…ç½®æ›´æ–°

## ğŸ“ éœ€è¦æ”¯æŒ

å¦‚æœåœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æ£€æŸ¥æ—¥å¿—ï¼š`wrangler tail aimagica-app`
2. æœ¬åœ°è°ƒè¯•ï¼š`npm run dev:workers`
3. æŸ¥çœ‹æ„å»ºè¾“å‡ºï¼š`dist/`ç›®å½•

---

**é¢„æœŸæ—¶é—´**: å®Œæ•´è¿ç§»çº¦éœ€1-2å¤©
**é£é™©ç­‰çº§**: ä¸­ç­‰ï¼ˆæœ‰ç°æœ‰æ¶æ„ä½œä¸ºå¤‡ä»½ï¼‰
**æ”¶ç›Š**: ç®€åŒ–æ¶æ„ï¼Œé™ä½æˆæœ¬ï¼Œæå‡æ€§èƒ½